{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ai_root/schemas/schema_task_notes.json",
  "title": "Task Notes Schema",
  "description": "Schema for TODO task notes.md files",
  "type": "object",
  "required": ["metadata", "sections"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["title", "type", "status", "created", "last_updated", "source_file"],
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "Task name"
        },
        "type": {
          "type": "string",
          "const": "task_notes"
        },
        "status": {
          "type": "string",
          "description": "Task status (e.g., incoming, in_progress, done)"
        },
        "created": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}([ T][0-9]{2}:[0-9]{2}(:[0-9]{2})?)?$"
        },
        "last_updated": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}([ T][0-9]{2}:[0-9]{2}(:[0-9]{2})?)?$"
        },
        "source_file": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "Task relationships",
      "properties": {
        "parent": {
          "type": ["string", "null"],
          "description": "Parent task name or null"
        },
        "depends_on": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Tasks this depends on"
        },
        "related": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Related tasks or resources"
        }
      }
    },
    "table_of_contents": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["section", "key"],
        "properties": {
          "section": {"type": "string"},
          "key": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$"
          }
        }
      }
    },
    "sections": {
      "type": "object",
      "minProperties": 1,
      "description": "Task content sections",
      "patternProperties": {
        "^[a-z][a-z0-9_]*$": {
          "type": "object",
          "required": ["heading", "content"],
          "properties": {
            "heading": {"type": "string"},
            "content": {"type": "string"}
          }
        }
      },
      "additionalProperties": false
    },
    "notes": {
      "type": "array",
      "description": "Timestamped notes log (optional)",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": {"type": "string"},
          "content": {"type": "string"}
        }
      }
    }
  }
}
