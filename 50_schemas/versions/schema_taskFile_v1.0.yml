# Task File Schema v1.0
# Defines the structure and validation rules for task definition files

metadata:
  name: Task File Schema
  version: 1.0.0
  date: 2025-11-23
  status: active
  description: Schema for req_XXXX_slug.md task definition files
  used_by: protocol_taskCoordination_latest.yml

file_naming:
  pattern: req_XXXX_slug.md
  components:
    req: Literal prefix
    XXXX: 4-digit zero-padded task ID (e.g., 1001, 1002)
    slug: Kebab-case task description (e.g., system-info, yaml-review)
    extension: .md (Markdown)
  examples:
    - req_1001_system_info.md
    - req_1019_yaml_md_review.md
    - req_2100_parallel_installation.md

folder_naming:
  pattern: req_XXXX_slug/
  matches: Task filename without extension
  claimed_pattern: claimed_{timestamp}_{pid}_req_XXXX_slug/
  timestamp_format: YYYYMMDD_HHMMSS

task_id_allocation:
  source_file: _NNNN_next_req_id
  location: Coordination root directory
  format: Plain text file containing next available ID
  increment: After successful task creation

# =============================================================================
# REQUIRED FIELDS
# =============================================================================

required_fields:
  title:
    format: "# Request #XXXX: Title"
    description: Markdown H1 header with request ID and descriptive title
    validation: Must match req_XXXX pattern in filename
    example: "# Request #1001: System Information Report"
  
  type:
    format: "**Type:** {value}"
    allowed_values:
      - Standard       # Normal task execution
      - Research       # Information gathering, analysis
      - Installation   # Software/tool installation
      - Testing        # Test execution, validation
      - Emergency      # Urgent, bypass normal queue
      - Maintenance    # Cleanup, organization, updates
    default: Standard
  
  priority:
    format: "**Priority:** {value}"
    allowed_values:
      - LOW            # Can wait, do when convenient
      - NORMAL         # Standard priority (default)
      - HIGH           # Should be done soon
      - URGENT         # Do next, interrupt lower priority
      - CRITICAL       # Drop everything, do now
    default: NORMAL
  
  posted:
    format: "**Posted:** {ISO 8601 timestamp}"
    description: When the task was created
    example: "**Posted:** 2025-11-23T15:30:00-06:00"
  
  description:
    format: "## Task Description\n{markdown content}"
    description: What needs to be done, context, requirements
    minimum_length: 1 sentence

  expected_response:
    format: "## Expected Response\n{description}"
    description: What the Worker should return/produce
    purpose: Sets clear completion criteria

# =============================================================================
# OPTIONAL FIELDS
# =============================================================================

optional_fields:
  commands:
    format: "## Task Commands\n```bash\n{commands}\n```"
    description: Specific bash commands to execute
    when_omitted: Worker determines appropriate commands
  
  discrete:
    format: "**Discrete:** true|false"
    description: If true, task should not be subdivided
    default: false (subdivision allowed)
  
  target_worker:
    format: "**Target Worker:** {worker_type} or {worker_type}:{pid}"
    description: Intended Worker type or specific instance
    examples:
      - "**Target Worker:** claude_cli"
      - "**Target Worker:** codex_cli:12345"
    when_omitted: Any available Worker may claim
  
  entry_criteria:
    format: "## Entry Criteria\n{list of conditions}"
    description: Prerequisites that must be met before starting
    when_omitted: Task can start immediately when claimed
  
  exit_criteria:
    format: "## Exit Criteria\n{list of conditions}"
    description: Conditions that define successful completion
    when_omitted: Worker judgment determines completion
  
  depends_on:
    format: "**Depends On:** req_XXXX, req_YYYY"
    description: Task IDs that must complete before this task starts
    status: "WALK STAGE - for Task Sets"

  sequence_id:
    format: "**Sequence:** {NNN}"
    description: Order within a Task Set (001, 002, etc.)
    status: "WALK STAGE - for Task Sets"
  
  notes:
    format: "## Notes\n{additional context}"
    description: Any additional information for the Worker
    examples:
      - Background context
      - Related tasks
      - Known issues to watch for

# =============================================================================
# TEMPLATE
# =============================================================================

template: |
  # Request #XXXX: {Title}
  
  **Type:** Standard
  **Priority:** NORMAL
  **Posted:** {ISO 8601 timestamp}
  
  ## Task Description
  
  {Describe what needs to be done. Include context, requirements, and any
  constraints the Worker should know about.}
  
  ## Task Commands
  
  ```bash
  # Commands to execute (optional - omit section if Worker should decide)
  {command_1}
  {command_2}
  ```
  
  ## Expected Response
  
  {Describe what the Worker should return. Be specific about format,
  content, and any files that should be created.}
  
  ## Notes
  
  {Optional: Additional context, related tasks, known issues.}

# =============================================================================
# VALIDATION RULES
# =============================================================================

validation:
  filename_matches_title:
    rule: XXXX in filename must match #XXXX in title
    severity: error

  required_sections_present:
    rule: Title, Type, Priority, Posted, Description, Expected Response must exist
    severity: error
  
  valid_type:
    rule: Type must be one of allowed_values
    severity: error
  
  valid_priority:
    rule: Priority must be one of allowed_values
    severity: error
  
  valid_timestamp:
    rule: Posted must be valid ISO 8601 format
    severity: error
  
  description_not_empty:
    rule: Task Description section must have content
    severity: error
  
  expected_response_not_empty:
    rule: Expected Response section must have content
    severity: warning

# =============================================================================
# EXAMPLES
# =============================================================================

examples:
  minimal:
    filename: req_1001_system_info.md
    content: |
      # Request #1001: System Information Report
      
      **Type:** Standard
      **Priority:** NORMAL
      **Posted:** 2025-11-23T15:30:00-06:00
      
      ## Task Description
      
      Gather basic system information for documentation purposes.
      
      ## Task Commands
      
      ```bash
      uname -a
      df -h
      ```
      
      ## Expected Response
      
      System details in markdown format with command outputs.

  full_featured:
    filename: req_1019_yaml_md_review.md
    content: |
      # Request #1019: YAML to Markdown Review
      
      **Type:** Research
      **Priority:** HIGH
      **Posted:** 2025-11-03T10:00:00-06:00
      **Target Worker:** claude_cli
      **Discrete:** true
      
      ## Entry Criteria
      
      - All YAML files in target directory exist
      - Previous migration task (req_1018) completed
      
      ## Task Description
      
      Review all YAML files that were converted from Markdown as part of
      the documentation migration. Verify:
      1. YAML syntax is valid
      2. All content from original MD preserved
      3. Structure follows schema conventions
      
      ## Task Commands
      
      ```bash
      find ~/Documents/AI/ai_general/instructions -name "*.yml" -exec yamllint {} \;
      ```
      
      ## Expected Response
      
      Summary report listing:
      - Files reviewed
      - Validation results per file
      - Any issues found with severity
      - Recommended fixes
      
      ## Exit Criteria
      
      - All files validated
      - No critical errors remaining
      - Report written to responses/
      
      ## Notes
      
      Related to req_1018 (YAML migration) and req_1020 (documentation update).
      If issues found, create follow-up tasks for fixes.

# =============================================================================
# REFERENCES
# =============================================================================

references:
  protocol: protocol_taskCoordination_latest.yml
  response_schema: See protocol file_formats.response_file section
  error_schema: See protocol file_formats.error_file section
