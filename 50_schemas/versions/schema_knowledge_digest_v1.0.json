{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ai_root/schemas/schema_knowledge_digest.json",
  "title": "Knowledge Digest Schema",
  "description": "Schema for knowledge digest documents (know_*.md files)",
  "type": "object",
  "required": ["metadata", "table_of_contents", "sections"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["title", "type", "topic", "status", "created", "last_updated", "source_file"],
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "const": "knowledge_digest"
        },
        "topic": {
          "type": "string",
          "minLength": 1,
          "description": "Brief topic description"
        },
        "status": {
          "type": "string",
          "description": "e.g., active, archived, draft"
        },
        "created": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}([ T][0-9]{2}:[0-9]{2}(:[0-9]{2})?)?$"
        },
        "last_updated": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}([ T][0-9]{2}:[0-9]{2}(:[0-9]{2})?)?$"
        },
        "context": {
          "type": "string",
          "description": "Optional context about why digest was created"
        },
        "maintainer": {
          "type": "string"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
          "description": "Semantic version number for this digest"
        },
        "source_file": {
          "type": "string",
          "minLength": 1
        },
        "related_files": {
          "type": "array",
          "items": {"type": "string"}
        },
        "related_chats": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "table_of_contents": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["section", "key"],
        "properties": {
          "section": {"type": "string"},
          "key": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$"
          },
          "subsections": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      }
    },
    "sections": {
      "type": "object",
      "minProperties": 1,
      "patternProperties": {
        "^[a-z][a-z0-9_]*$": {
          "type": "object",
          "required": ["heading", "content"],
          "properties": {
            "heading": {"type": "string"},
            "content": {"type": "string"}
          }
        }
      },
      "additionalProperties": false
    },
    "footer": {
      "type": "object",
      "description": "Optional digest metadata",
      "properties": {
        "digest_size": {
          "type": "string",
          "description": "e.g., ~7KB"
        },
        "refresh_trigger": {
          "type": "string",
          "description": "Conditions for updating this digest"
        }
      }
    }
  }
}
