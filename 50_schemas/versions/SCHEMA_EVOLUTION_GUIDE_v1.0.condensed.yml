meta: {v: 1.0, purpose: "authoritative reference for evolving JSON Schemas"}

overview:
  backward_compatible: old docs validate under new schema
  forward_compatible: new docs validate under old schema
  breaking: previously valid docs fail or processors can't interpret

composition_patterns:
  "$ref": "reuse definition from same/other file"
  "$defs": "local fragment library, reference via $ref"
  allOf: "intersect schemas (inheritance/mixins)"
  "oneOf/anyOf": "polymorphic content (oneOf=exactly one, anyOf=at least one)"
  external: "file URLs or absolute $id values"
  best_practices: [prefer $defs+$ref over copying, add title/desc with allOf+$ref, use discriminators for oneOf]

backward_compatible_changes:
  adding_optional_fields: add to properties without adding to required
  new_sections: extend patternProperties with new $ref/oneOf branches
  relaxing_constraints: increase maxLength, widen enums, loosen regex (document it)

breaking_changes:
  adding_required: {why: "existing docs lack property", strategy: "stage optional → populate → mark required"}
  removing_fields: {why: "producers still emit", strategy: "deprecate → update producers → remove"}
  changing_types: {why: "invalidates docs and code", strategy: "new property foo_v2 or oneOf bridge"}
  tightening: {why: "lower max, narrower enum", strategy: "audit data → lint → tighten"}

migration_plan: [audit existing docs, communicate intent, provide transform scripts, tag versions for pinning]

additionalProperties:
  "true": allows unknown keys, max extensibility
  "false": blocks unknown, strongest guarantees
  per_object: mix via patternProperties or unevaluatedProperties
  note: "true→false is breaking, false→true hides typos"

versioning:
  document_level: embed metadata.version
  schema_level: schema_*_v1.json, v2.json with alias to latest
  git_based: tag commits, pin via tags/submodules
  hybrid: both doc-level + git tags (recommended)

workflows:
  adding_optional: [update schema, add docs/examples, update producers, run validators, communicate]
  breaking: [design + rationale, branch, implement + scripts, validate against historic, migrate, communicate]
  testing: [ajv/jsonschema validation, positive/negative fixtures, CI checks]

knowledge_digest_guidance:
  structure: {metadata: "...", table_of_contents: "...", sections: "...", footer: "..."}
  extensibility: metadata supports optional fields, sections via patternProperties
  blocked: new top-level objects, additional section properties
  common_evolutions: [add metadata fields, new section payloads, richer per-section metadata, expand footer]
  recommended: [use oneOf for richer sections, add optional top-level properties, maintain key patterns]
