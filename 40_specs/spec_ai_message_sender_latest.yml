---
# AI Message Sender Specification
# Version: 1.0
# Created: 2025-11-01
# Purpose: Universal message injection for AI desktop applications

metadata:
  name: AI Message Sender
  version: "1.0"
  created: "2025-11-01"
  author: PianoMan
  status: production
  location: /Users/shawnhillis/bin/projects/chat_orchestrators/send_ai_message.sh
  
summary: |
  Universal mechanism for external processes to send messages to AI desktop 
  applications (Claude, ChatGPT) via AppleScript automation. Enables system 
  notifications, scheduled prompts, CLI completion alerts, and cross-AI 
  communication without requiring human intervention.

interface:
  command: send_ai_message.sh
  
  parameters:
    - name: app
      position: 1
      type: string
      required: true
      valid_values:
        - claude
        - chatgpt
      description: Target AI application
      
    - name: message
      position: 2
      type: string
      required: true
      description: Message text to send (can be multi-line)
      notes: |
        - Shell escaping applies (quote if spaces/special chars)
        - Newlines preserved if properly escaped
        - No length limit enforced (but app may have limits)
  
  return_codes:
    0: Success - message sent
    1: Error - invalid parameters or AppleScript failure
  
  output:
    stdout: Success/error message
    stderr: AppleScript errors if any
    
  examples:
    - description: Send to Claude
      command: send_ai_message.sh claude "Task completed successfully"
      
    - description: Send to ChatGPT
      command: send_ai_message.sh chatgpt "Please analyze this result"
      
    - description: Multi-line message
      command: |
        send_ai_message.sh claude "Line 1
        Line 2
        Line 3"
        
    - description: From variable
      command: |
        result=$(some_command)
        send_ai_message.sh claude "Analysis complete: $result"
        
    - description: Scheduled via cron
      command: |
        # crontab entry
        0 9 * * * send_ai_message.sh claude "Daily standup: What are priorities?"

behavior:
  activation:
    description: Activates target app and brings to foreground
    timing: 1 second delay after activation
    side_effect: May interrupt user's current focus
    
  message_input:
    method: Keystroke simulation via AppleScript
    target: Currently active conversation in app
    timing: 0.5 second delay before Enter key
    
  submission:
    method: Enter key (key code 36)
    retry: None (single attempt)
    
  conversation_targeting:
    description: |
      Messages are sent to WHICHEVER conversation is currently open/active
      in the target app. This is by design - allows targeting specific 
      conversations by opening them first.
      
    implications:
      - No conversation URL parameter needed
      - Can target any conversation by opening it first
      - Can maintain multi-turn interactions by keeping conversation open
      - User controls targeting through app state
      
  response_handling:
    read_response: false
    description: |
      Script does not read AI responses. One-way communication only.
      Human can see both sides in the app window.
      
  concurrency:
    description: Not thread-safe - simultaneous calls may interfere
    recommendation: Serialize calls with lock file or queue

use_cases:
  system_notifications:
    description: Alert AI about system events
    examples:
      - Disk space warnings
      - Backup completion
      - Error conditions
      - Resource thresholds
      
  cli_completion:
    description: CLI instances notify Desktop AI of task completion
    examples:
      - "Task #1234 completed. Results in responses/cli_73193/"
      - "Build finished: 0 errors, 3 warnings"
      - "Analysis complete. See /tmp/results.csv"
      
  scheduled_prompts:
    description: Cron jobs send periodic reminders or triggers
    examples:
      - Daily standup prompts
      - Hourly status checks
      - End-of-day review triggers
      - Periodic health checks
      
  alarm_clock:
    description: Wake up AI instances with scheduled messages
    pattern: |
      # Every hour on the hour
      0 * * * * send_ai_message.sh claude "Hourly check-in: Any updates?"
      
  cross_ai_communication:
    description: One AI sends updates to another
    examples:
      - ChatGPT analysis results → Claude for synthesis
      - CLI instance → Desktop Claude for review
      - External monitoring → Both AIs for awareness
      
  async_collaboration:
    description: Leave messages for AI to process when convenient
    examples:
      - Overnight batch results
      - Long-running analysis outputs
      - External data feed updates

integration_points:
  cli_coordination:
    description: CLI instances send completion notifications
    workflow: |
      1. CLI completes task in coordination system
      2. Writes response to responses/cli_PID/
      3. Calls send_ai_message.sh to notify Desktop Claude
      4. Desktop Claude sees notification and reads response
      
  chat_orchestrator:
    description: Inject messages into orchestrated conversations
    use_case: Human intervention or external data injection
    
  file_monitoring:
    description: Watch directories and notify on changes
    pattern: |
      inotifywait -m ~/results/ -e create |
      while read path action file; do
        send_ai_message.sh claude "New file: $file"
      done
      
  monitoring_systems:
    description: System health alerts to AI
    examples:
      - Nagios/Icinga alerts
      - CloudWatch events
      - Custom monitoring scripts

technical_details:
  implementation:
    language: Bash wrapper around AppleScript
    dependencies:
      - macOS AppleScript
      - System Events accessibility permissions
      - Target app must be installed
      
  applescript_core:
    activation: tell application "<AppName>" to activate
    input: keystroke via System Events
    submission: key code 36 (Enter)
    
  timing:
    activation_delay: 1.0s
    typing_delay: 0.5s
    total_minimum: ~1.5s per message
    
  error_handling:
    invalid_app: Exit code 1, error message
    applescript_failure: Exit code 1, stderr output
    app_not_running: AppleScript error (not caught)
    
  limitations:
    - No response reading
    - No conversation URL targeting (uses active conversation)
    - No retry logic
    - Single-threaded (concurrent calls may conflict)
    - Requires app focus (interrupts user)
    - No rate limiting
    - No message queue

future_enhancements:
  v1.1:
    - Add retry logic with exponential backoff
    - Add --no-focus flag to prevent activation
    - Add timeout parameter
    - Add logging to file option
    
  v1.2:
    - Add conversation URL parameter (open specific chat first)
    - Add response reading via clipboard
    - Add --wait-for-response flag
    
  v2.0:
    - Add message queue for batch sends
    - Add rate limiting
    - Add lock file for concurrency control
    - Add background daemon mode
    - Add response capture to file
    
  v3.0:
    - Support web-based AIs via Puppeteer
    - Support API-based AIs
    - Unified interface across all AI platforms

testing:
  manual_test:
    description: Send test message via scheduled task
    command: |
      (sleep 60 && send_ai_message.sh claude "TEST: $(date)") &
      
  validation:
    - Message appears in target app conversation
    - Timestamp accurate within 1 second
    - Script exits with code 0
    - No error messages in stderr
    
  edge_cases:
    - App not running (should fail gracefully)
    - Empty message (behavior undefined)
    - Very long message (may exceed app limits)
    - Special characters (", ', $, `)
    - Multi-line messages with newlines

related_systems:
  - CLI Coordination Protocol v3.1
  - Chat Orchestrator (Puppeteer-based)
  - Desktop Claude Prompt Sender v2.0 (file-based queue)
  - Claude Monitor (lock file detector)

files:
  script: /Users/shawnhillis/bin/projects/chat_orchestrators/send_ai_message.sh
  documentation: /Users/shawnhillis/bin/projects/chat_orchestrators/UNIVERSAL_SENDER.md
  specification: /Users/shawnhillis/Documents/AI/ai_general/specs/ai_message_sender_spec_v01.yml

changelog:
  v1.0:
    date: "2025-11-01"
    changes:
      - Initial implementation
      - Support for Claude and ChatGPT
      - Parameter order: app first, message second
      - Tested and validated in production
