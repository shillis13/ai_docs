version: 1.1.0
last_updated: 2025-10-19
maintainer: PianoMan
status: active
summary: Canonical metadata footer appended to every AI response.
format:
  delimiter: " | "
  order:
    - AI_Name
    - Persona
    - Proj
    - Chat
    - Timestamp
    - Msg
    - Usage
    - Artifacts
    - Tags
  fields:
    - name: AI_Name
      description: Display name for the responding persona.
      example: "Chatty"
    - name: Persona
      description: Persona version with optional delta marker (Δ, Δ+, Δ*).
      example: "Persona:v8.5Δ+"
    - name: Proj
      description: Short project identifier (CamelCase or hyphenated, no spaces).
      example: "Proj:DevelopmentStuff"
    - name: Chat
      description: Human-readable chat title.
      example: "Chat:Workspace setup review (cont.)"
    - name: Timestamp
      description: Local timestamp in ISO format with seconds.
      example: "2025-10-19 23:45:00"
    - name: Msg
      description: Zero-indexed assistant message counter for the chat.
      example: "Msg:12"
    - name: Usage
      description: Context usage as approximate percentage (~X%) or NA when not applicable.
      example: "Usage:~28%"
    - name: Artifacts
      description: Count of artifacts created in this message (files, canvases, etc.).
      example: "Artifacts:1"
    - name: Tags
      description: 2–8 descriptive keywords, comma-separated, kebab-case for multi-word.
      example: "Tags: footer-spec, metadata, regex"
rules:
  persona_deltas:
    - marker: "Δ"
      meaning: Minor refinement or parameter adjustment.
    - marker: "Δ+"
      meaning: Significant update or behavioral expansion.
    - marker: "Δ*"
      meaning: Experimental or transient branch.
    - emission_note: Only emit a delta marker in the message that causes or announces the change.
  usage_field:
    - prefer_percentage: Emit `Usage:~X%` when a measurable resource ratio exists.
    - fallback: Emit `Usage:NA` when undefined, unbounded, or irrelevant.
  artifacts_field:
    - counting_rule: Count only artifacts created in the current message.
    - typical_items:
        - canvas_document
        - generated_file
        - external_attachment
validation:
  canonical_regex: >
    ^(?P<ai>[^|]+?)\s*\|\s*Persona:v(?P<ver>\d+\.\d+)(?P<delta>Δ\+?|Δ\*)?\s*\|\s*Proj:(?P<proj>[A-Za-z0-9-]+)\s*\|\s*Chat:(?P<chat>[^|]+?)\s*\|\s*(?P<ts>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\s*\|\s*Msg:(?P<msg>\d+)\s*\|\s*Usage:(?:~(?P<usage>\d{1,3})%|NA)\s*\|\s*Artifacts:(?P<artifacts>\d+)\s*\|\s*Tags:\s*(?P<tags>.*)$
  javascript_helper: |
    export const FOOTER_RE = new RegExp(
      String.raw`^([^|]+?)\s*\|\s*` +
      String.raw`Persona:v(\d+\.\d+)(Δ\+?|Δ\*)?\s*\|\s*` +
      String.raw`Proj:([A-Za-z0-9-]+)\s*\|\s*` +
      String.raw`Chat:([^|]+?)\s*\|\s*` +
      String.raw`(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\s*\|\s*` +
      String.raw`Msg:(\d+)\s*\|\s*` +
      String.raw`Usage:(?:~(\d{1,3})%|NA)\s*\|\s*` +
      String.raw`Artifacts:(\d+)\s*\|\s*` +
      String.raw`Tags:\s*(.*)$`
    );

    export function footerValidate(line) {
      const match = FOOTER_RE.exec(line);
      if (!match) return { ok: false };
      const [ , ai, ver, delta, proj, chat, ts, msg, usagePct, artifacts, tags ] = match;
      return {
        ok: true,
        ai,
        ver,
        delta: delta || '',
        proj,
        chat,
        ts,
        msg: Number(msg),
        usage: usagePct ? `~${usagePct}%` : 'NA',
        artifacts: Number(artifacts),
        tags
      };
    }
examples:
  - "Chatty | Persona:v8.5 | Proj:DevelopmentStuff | Chat:Workspace setup review (cont.) | 2025-10-19 23:45:00 | Msg:12 | Usage:NA | Artifacts:1 | Tags: footer-spec, metadata, regex"
  - "Chatty | Persona:v8.5Δ+ | Proj:DevStuff | Chat:Persona tuning session | 2025-10-20 09:02:01 | Msg:0 | Usage:~22% | Artifacts:0 | Tags: persona, evolution, marker"
