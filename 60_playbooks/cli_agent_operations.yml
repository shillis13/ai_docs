---
metadata:
  title: CLI Agent Operations Guide
  version: 1.0.0
  created: 2025-12-08
  maintainer: PianoMan
  status: active
  location: ai_general/docs/30_guides/cli_agent_operations.yml

overview:
  purpose: |
    Quick reference for running CLI agents. Desktop Claude coordinates strategy;
    CLI agents execute specialized work autonomously.
  
  wrapper_script: ~/bin/ai/cli/claude_cli.sh
  agent_definitions: ~/.claude/agents.json
  
  architecture: |
    Desktop Claude (Architect/Systems)
           │
           ├── Strategic planning, research, design
           ├── Cross-cutting decisions  
           ├── Documentation standards
           └── Delegates execution to CLI agents
                    │
        ┌───────────┼───────────┬───────────┐
        │           │           │           │
    dev-lead   librarian   custodian     ops

agents:
  dev-lead:
    purpose: Development coordination, code review, task curation
    responsibilities:
      - Curate and refine ai_general/todos/
      - Create Task files, place in staged/
      - Code review and quality enforcement
      - Absorbs Developer and I&T perspectives
    working_dir: ~/Documents/AI/ai_root
    
  librarian:
    purpose: Knowledge pipeline management
    responsibilities:
      - Process chat exports (10→20→30→40 pipeline)
      - Create/maintain summaries colocated with histories
      - Build cross-chat threads in 50_threads/
      - Does NOT own ai_general/docs/
    working_dir: ~/Documents/AI/ai_root
    
  custodian:
    purpose: Repository and filesystem hygiene
    responsibilities:
      - Maintain directory structure consistency
      - Update *_latest symlinks
      - Archive superseded versions
      - Enforce naming conventions
    working_dir: ~/Documents/AI/ai_root
    
  ops:
    purpose: Task execution from coordination system
    responsibilities:
      - Monitor coordination directories
      - Execute tasks from to_execute/
      - Write responses to responses/
      - Report completion status
    working_dir: ~/Documents/AI/ai_root


usage:
  basic_syntax: |
    claude_cli.sh [options] [command] [prompt]
  
  launch_agent:
    interactive:
      command: claude_cli.sh -A <agent> -a
      example: claude_cli.sh -A librarian -a
      notes: Opens interactive session with agent persona loaded
    
    with_prompt:
      command: claude_cli.sh -A <agent> "<prompt>"
      example: claude_cli.sh -A dev-lead "Review staged tasks"
      
    tmux_background:
      command: claude_cli.sh -A <agent> -t "<prompt>"
      example: claude_cli.sh -A ops -t "Process to_execute queue"
      notes: |
        Runs in detached tmux session. Returns immediately with:
        - TMUX_SESSION name
        - OUTPUT_LOG path
        - Monitor/attach/kill commands

  session_management:
    continue_last:
      command: claude_cli.sh -c "<prompt>"
      notes: Continues most recent session in current project dir
      
    resume_by_id:
      command: claude_cli.sh -r <session_id> "<prompt>"
      
    named_sessions:
      register: claude_cli.sh register <name> <session_id> <project_dir> [description]
      resume: claude_cli.sh -n <name> "<prompt>"
      list: claude_cli.sh registry [--verbose]
      
  queries:
    list_sessions: claude_cli.sh list <project_dir> [limit]
    latest_session: claude_cli.sh latest <project_dir>
    session_info: claude_cli.sh info <session_id>

  coordination_tasks:
    execute_task_file: claude_cli.sh task <path_to_task.md>
    notes: |
      Task files support YAML front matter with:
      - session_mode: new | continue | auto
      - project_dir: working directory

common_workflows:
  librarian_export_processing:
    steps:
      - "Export chat from Claude/ChatGPT to ai_memories/10_exported/"
      - "claude_cli.sh -A librarian -a"
      - "Librarian processes through pipeline automatically"
    
  dev_lead_task_curation:
    steps:
      - "Add rough todo item to ai_general/todos/"
      - "claude_cli.sh -A dev-lead 'Review and refine todos'"
      - "Dev-lead creates Task files in staged/"
      - "Orchestrator reviews and moves to to_execute/"
    
  ops_task_execution:
    steps:
      - "Task file placed in to_execute/"
      - "claude_cli.sh -A ops -t 'Check inbox and execute'"
      - "Ops claims task, executes, writes response"
      - "Monitor: tail -f <output_log>"

flags_reference:
  execution:
    -t, --tmux: Run in background tmux session
    -s, --session: Custom tmux session name
    -i, --interactive: Explicit interactive mode
    -a, --auto-approve: Skip permission prompts
    -w, --workdir: Override working directory
    -A, --agent: Load agent persona
    -o, --output: Write output to file
    --no-mcp: Run without MCP servers
    
  session:
    -c, --continue: Continue most recent session
    -r, --resume: Resume by session ID
    -n, --named: Resume by registered name

related_docs:
  - path: ai_general/docs/40_specs/cli_specialized_agent_roles_v2.md
    rel: Full role definitions and responsibilities
  - path: ai_general/docs/40_specs/cli_coordination_protocol_v4.md
    rel: Task coordination system details
  - path: ~/.claude/agents.json
    rel: Agent prompt definitions

# =============================================================================
# CODEX CLI (OpenAI) - Autonomous Coding Agent
# =============================================================================

codex_cli:
  overview: |
    Separate tool from Claude CLI. OpenAI's Codex is a coding-focused agent
    with its own sandbox, approval workflow, and autonomous execution.
    Use for code debugging, refactoring, testing tasks.
  
  wrapper_script: ~/bin/ai/cli/codex_cli.sh
  binary: /usr/local/bin/codex (or /opt/homebrew/bin/codex)
  log_dir: ~/Documents/AI/ai_root/ai_general/logs/codex_cli/
  
  when_to_use:
    - Code debugging and fixing
    - Autonomous multi-step coding tasks
    - Tasks requiring sandbox isolation
    - When Claude CLI agents aren't code-focused enough
  
  vs_claude_cli: |
    Claude CLI: General-purpose agents with personas (librarian, dev-lead, etc.)
    Codex CLI: Code-focused autonomous agent, better for debugging/refactoring
  
  usage:
    interactive:
      command: codex_cli.sh -i
      
    with_prompt:
      command: codex_cli.sh "<prompt>"
      example: codex_cli.sh "Fix the YAML parsing bug in doc_converter.py"
      
    tmux_background:
      command: codex_cli.sh -t -s <session> -p -a "<prompt>"
      example: codex_cli.sh -t -s docfix -p -a "Debug and fix doc_converter.py"
      notes: |
        Returns TMUX_SESSION, LOG_FILE
        Monitor: tmux capture-pane -t <session> -p
        Attach: tmux attach -t <session>
        Kill: tmux kill-session -t <session>
  
  flags:
    -t, --tmux: Run in background tmux session
    -s, --session: Custom tmux session name
    -w, --workdir: Working directory
    -p, --print: Non-interactive print mode
    -a, --auto: Auto-approve (full-auto mode)
    -i, --interactive: Interactive session
