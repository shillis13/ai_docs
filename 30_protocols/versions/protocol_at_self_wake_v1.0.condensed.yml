meta: {v: 1.0.0, created: 2025-12-10, status: active, category: pattern}

summary: Desktop Claude sets AT job to self-prompt after delegating, enabling periodic monitoring without human intervention

problem: |
  Desktop Claude has no agency between responses. After delegating to CLI:
  - Claude said "I'll check in" but with what mechanism?
  - Claude only wakes when prompted
  - CLI can't reliably prompt Desktop (conversation locks)

solution: AT job as self-wake alarm - schedules future prompt to itself

key_insight: "AT is my wake-up alarm, not CLI's doorbell"

behavior: |
  CLI completion isn't important enough to force-interrupt.
  Desktop wakes on schedule, checks progress, then:
  - Sets another AT if work continues
  - Wraps up if complete
  - Intervenes if stuck

implementation:
  set_alarm: |
    cat << 'EOF' | at now + 3 minutes
    /path/to/send_prompt.sh claude-desktop "AT wake-up: Check status" --force --submit
    EOF

  wake_check:
    - tmux session alive?
    - progress made (new/updated files)?
    - worker stuck waiting?

  decision_tree:
    "running + progress": set another AT
    "complete": clean up, report
    "stuck": intervene or escalate

prerequisites:
  - send_prompt.sh with --force flag
  - AT daemon running (launchd on macOS)
  - Desktop accessible via AppleScript

flow:
  1: Desktop creates task spec
  2: Desktop launches CLI in tmux (-t)
  3: Desktop sets AT for N minutes
  4: Desktop sleeps
  5: AT fires â†’ send_prompt.sh --force
  6: Desktop wakes, checks status
  7: repeat 3-6 or wrap up

advantages:
  - no conversation lock bypass from worker
  - predictable wake intervals
  - Desktop maintains oversight
  - worker fully autonomous
  - human not required

limitations:
  - AT minimum 1 minute granularity
  - requires AT daemon
  - send_prompt.sh --force must work
  - no interrupt for urgent issues

future: [priority channel for alerts, adaptive intervals, multi-worker monitoring, escalation to user]
