meta: {discovered: 2025-12-05, status: documented}

storage:
  local:
    history.jsonl: "session index (sessionId, timestamp, project, prompt)"
    "session-env/<uuid>/": placeholder for env vars
    "file-history/<uuid>/": file changes during session
    "debug/<uuid>.txt": debug logs
    projects/: per-project settings (path-encoded)
  server: "conversation content retrieved via sessionId"
  key_insight: "content NOT local - sessionId retrieves server-stored context via 'claude -r <sessionId>'"

history_format: {display: "user prompt", pastedContents: {}, timestamp: epoch_ms, project: "/path/to/dir", sessionId: "uuid"}
scoping: "sessions scoped by project directory"

cli_commands:
  "claude -c 'prompt'": continue most recent in current dir
  "claude -r <id> 'prompt'": resume specific session
  "claude -r": interactive session picker

wrapper:
  loc: ~/bin/ai/claude_cli_session.sh
  query:
    list: "./claude_cli_session.sh list ~/path/to/project"
    latest: "./claude_cli_session.sh latest ~/path/to/project"
    info: "./claude_cli_session.sh info <session_id>"
  execution:
    new: "./claude_cli_session.sh new ~/project 'prompt'"
    continue: "./claude_cli_session.sh continue ~/project 'prompt'"
    resume: "./claude_cli_session.sh resume <id> 'prompt'"
    auto: "./claude_cli_session.sh auto ~/project 'prompt'"
    task: "./claude_cli_session.sh task /path/to/task.md"

task_file_format:
  frontmatter: {session_mode: "auto|new|continue|resume:<ID>", project_dir: "path"}
  template: ~/.claude/coordination/docs/task_template_session_aware.md

patterns:
  persistent_worker: "session_mode: continue - accumulates context across tasks"
  fresh_session: "session_mode: new - isolated one-off work"
  named_streams: "multiple logical work streams per project via specific session IDs"

implications:
  - "CLI workers build expertise through accumulated understanding"
  - "session continuity is free via native -c/-r"
  - "project-scoped context = natural isolation"
  - "server-side storage = no local cleanup needed"

open_questions: [retention duration, size limits, cross-device resume]

files_created:
  - ~/bin/ai/cli/claude_cli_session.sh (643 lines)
  - ~/.claude/session_registry.yml
  - ai_general/docs/30_protocols/cli_session_persistence.md
  - ai_general/templates/cli_task_session_aware.md
