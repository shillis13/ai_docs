# Protocol: Condensed File Resolution
# Version: 1.0
# Purpose: Efficient resolution of REF:/see: pointers using condensed versions when available

resolution_algorithm:
  trigger: "Any REF: or see: pointer to .yml or .md file"
  steps:
    1_parse_target: "Extract target path from pointer"
    2_check_condensed:
      action: "Check if {basename}.condensed.yml exists in same directory"
      locations:
        - "{directory}/{basename}.condensed.yml"
        - "{directory}/condensed/{basename}.condensed.yml"
    3_load:
      condensed_exists: "Load condensed version"
      condensed_missing: "Load original file"

rationale:
  why_condensed_first:
    - "Reduces token consumption by 60-80%"
    - "Faster context loading"
    - "Preserves essential semantics"
  when_original_needed:
    - "Deep implementation details required"
    - "Condensed version missing or outdated"
    - "Explicit request: REF:full: or see:full:"

examples:
  standard_resolution:
    pointer: "REF: protocol_taskCoordination_latest.yml"
    check: "protocol_taskCoordination_latest.condensed.yml exists?"
    result_yes: "Load condensed version"
    result_no: "Load original"

  explicit_full:
    pointer: "REF:full: protocol_taskCoordination_latest.yml"
    action: "Always load original, skip condensed check"

  subdirectory_condensed:
    pointer: "see: 30_protocols/protocol_ai_chat_orchestration_latest.yml"
    check_paths:
      - "30_protocols/protocol_ai_chat_orchestration_latest.condensed.yml"
      - "30_protocols/condensed/protocol_ai_chat_orchestration_latest.condensed.yml"

edge_cases:
  symlinks: "Resolve symlink first, then check for condensed of target"
  circular_refs: "Track visited files, skip already-loaded"
  version_mismatch: "Condensed metadata.source_version must match original"
  missing_condensed: "Silent fallback to original (not an error)"

validation:
  condensed_must_have:
    - "metadata.source_file: original filename"
    - "metadata.condensed_date: ISO timestamp"
  staleness_check: "Compare condensed_date to original file mtime"
